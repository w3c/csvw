<!DOCTYPE html>
<html lang="en" dir="ltr" typeof="bibo:Document w3p:WD" about="" property="dcterms:language" content="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1" name="viewport">
    <title>Model for Tabular Data and Metadata on the Web</title>
    
    
    <style type="text/css">
      .grammar td { font-family: monospace; vertical-align: top; }
      .grammar-literal { color: gray;}
    </style>
  <style>/*****************************************************************
 * ReSpec 3 CSS
 * Robin Berjon - http://berjon.com/
 *****************************************************************/

/* --- INLINES --- */
em.rfc2119 { 
    text-transform:     lowercase;
    font-variant:       small-caps;
    font-style:         normal;
    color:              #900;
}

h1 acronym, h2 acronym, h3 acronym, h4 acronym, h5 acronym, h6 acronym, a acronym,
h1 abbr, h2 abbr, h3 abbr, h4 abbr, h5 abbr, h6 abbr, a abbr {
    border: none;
}

dfn {
    font-weight:    bold;
}

a.internalDFN {
    color:  inherit;
    border-bottom:  1px solid #99c;
    text-decoration:    none;
}

a.externalDFN {
    color:  inherit;
    border-bottom:  1px dotted #ccc;
    text-decoration:    none;
}

a.bibref {
    text-decoration:    none;
}

cite .bibref {
    font-style: normal;
}

code {
    color:  #ff4500;
}

/* --- TOC --- */
.toc a, .tof a {
    text-decoration:    none;
}

a .secno, a .figno {
    color:  #000;
}

ul.tof, ol.tof {
    list-style: none outside none;
}

.caption {
    margin-top: 0.5em;
    font-style:   italic;
}

/* --- TABLE --- */
table.simple {
    border-spacing: 0;
    border-collapse:    collapse;
    border-bottom:  3px solid #005a9c;
}

.simple th {
    background: #005a9c;
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
}

.simple th[scope="row"] {
    background: inherit;
    color:  inherit;
    border-top: 1px solid #ddd;
}

.simple td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
    background: #f0f6ff;
}

/* --- DL --- */
.section dd > p:first-child {
    margin-top: 0;
}

.section dd > p:last-child {
    margin-bottom: 0;
}

.section dd {
    margin-bottom:  1em;
}

.section dl.attrs dd, .section dl.eldef dd {
    margin-bottom:  0;
}

@media print {
    .removeOnSave {
        display: none;
    }
}
</style><style>/* --- ISSUES/NOTES --- */
div.issue-title, div.note-title {
    padding-right:  1em;
    min-width: 7.5em;
    color: #b9ab2d;
}
div.issue-title { color: #e05252; }
div.note-title { color: #2b2; }
div.issue-title span, div.note-title span {
    text-transform: uppercase;
}
div.note, div.issue {
    margin-top: 1em;
    margin-bottom: 1em;
}
.note > p:first-child, .issue > p:first-child { margin-top: 0 }
.issue, .note {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
}
div.issue, div.note {
    padding: 1em 1.2em 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
span.note, span.issue { padding: .1em .5em .15em; }

.issue {
    border-color: #e05252;
    background: #fbe9e9;
}
.note {
    border-color: #52e052;
    background: #e9fbe9;
}


</style><link href="https://www.w3.org/StyleSheets/TR/W3C-WD" rel="stylesheet"><!--[if lt IE 9]><script src='https://www.w3.org/2008/site/js/html5shiv.js'></script><![endif]--></head>
  <body id="respecDocument" role="document" class="h-entry"><div id="respecHeader" role="contentinfo" class="head">
  <p>
    
      <a href="http://www.w3.org/"><img src="https://www.w3.org/Icons/w3c_home" alt="W3C" height="48" width="72"></a>
    
  </p>
  <h1 class="title p-name" id="title" property="dcterms:title">Model for Tabular Data and Metadata on the Web</h1>
  
  <h2 id="w3c-working-draft-10-july-2014" property="dcterms:issued" datatype="xsd:dateTime" content="2014-07-09T22:00:00.000Z"><abbr title="World Wide Web Consortium">W3C</abbr> Working Draft <time class="dt-published" datetime="2014-07-10">10 July 2014</time></h2>
  <dl>
    
      <dt>This version:</dt>
      <dd><a class="u-url" href="http://www.w3.org/TR/2014/WD-tabular-data-model-20140710/">http://www.w3.org/TR/2014/WD-tabular-data-model-20140710/</a></dd>
      <dt>Latest published version:</dt>
      <dd><a href="http://www.w3.org/TR/tabular-data-model/">http://www.w3.org/TR/tabular-data-model/</a></dd>
    
    
      <dt>Latest editor's draft:</dt>
      <dd><a href="http://w3c.github.io/csvw/syntax/">http://w3c.github.io/csvw/syntax/</a></dd>
    
    
    
    
    
    
      <dt>Previous version:</dt>
      <dd><a rel="dcterms:replaces" href="http://www.w3.org/TR/2014/WD-tabular-data-model-20140327/">http://www.w3.org/TR/2014/WD-tabular-data-model-20140327/</a></dd>
    
    
    <dt>Editors:</dt>
    <dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><span property="foaf:name" class="p-name fn">Jeni Tennison</span>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://theodi.org/">Open Data Institute</a></span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Gregg Kellogg" href="http://greggkellogg.net/">Gregg Kellogg</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://kellogg-assoc.com/">Kellogg Associates</a></span>
</dd>

    
    
      
        
          <dt>Repository:</dt>
          
             
                
                  <dd>
                    <a href="https://github.com/w3c/csvw">
                      We are on Github
                    </a>
                  </dd>
                
             
                
                  <dd>
                    <a href="https://github.com/w3c/csvw">
                      File a bug
                    </a>
                  </dd>
                
             
          
        
      
        
          <dt>Changes:</dt>
          
             
                
                  <dd>
                    <a href="diff-20140327.html">
                      Diff to previous version
                    </a>
                  </dd>
                
             
                
                  <dd>
                    <a href="https://github.com/w3c/csvw/commits/gh-pages">
                      Commit history
                    </a>
                  </dd>
                
             
          
        
      
    
  </dl>
  
  
  
  
    
      <p class="copyright">
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> ©
        2014
        
        <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup>
        (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
        <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
        <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>), 
        
        All Rights Reserved.
        
        <abbr title="World Wide Web Consortium">W3C</abbr> <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and
        
          <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a>
        
        rules apply.
      </p>
    
  
  <hr>
</div>
    <section rel="bibo:Chapter" resource="#abstract" typeof="bibo:Chapter" datatype="" property="dcterms:abstract" class="introductory" id="abstract"><h2 id="h2_abstract" role="heading" aria-level="1">Abstract</h2>
      <p>
        Tabular data is routinely transferred on the web as "CSV", but the definition of "CSV" in practice is very loose. This document outlines a basic data model or infoset for tabular data and metadata about that tabular data. It also contains some non-normative information about a best practice syntax for tabular data, for mapping into that data model, to contribute to the standardisation of CSV syntax by IETF. Various methods of locating metadata are also provided.
      </p>
    </section><section rel="bibo:Chapter" resource="#sotd" typeof="bibo:Chapter" id="sotd" class="introductory"><h2 id="h2_sotd" role="heading" aria-level="1">Status of This Document</h2>
  
    
      
        <p>
          <em>This section describes the status of this document at the time of its publication.
          Other documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the
          latest revision of this technical report can be found in the <a href="http://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at
          http://www.w3.org/TR/.</em>
        </p>
        
      <p>
        The CSV on the Web Working Group was chartered to produce a Recommendation "Access methods for CSV Metadata" as well as Recommendations for "Metadata vocabulary for CSV data" and "Mapping mechanism to transforming CSV into various Formats (e.g., RDF, JSON, or XML)". This document aims to primarily satisfy the first of those Recommendations (see <a href="#locating-metadata" class="sectionRef sec-ref">section <span class="secno">3.</span> <span class="sec-title">Locating Metadata</span></a>), though it also specifies an underlying model and therefore starting point for the other chartered Recommendations.
      </p>
      <p>
        This document is based on IETF's [<cite><a href="#bib-RFC4180" class="bibref">RFC4180</a></cite>] which is an Informational RFC. The working group's expectation is that future suggestions to refine RFC 4180 will be relayed to the IETF (e.g. around I18N and multi-part packaging) and contribute to its discussions about moving CSV to the Standards track.
      </p>
      <p>
        Many "CSV" files embed metadata, for example in lines before the header row of the CSV document. This specification does not define any formats for embedding metadata within CSV files, aside from the names of columns in the header row.
      </p>
    
        <p>
          This document was published by the <a href="http://www.w3.org/2013/csvw/">CSV on the Web Working Group</a> as a Working Draft.
          
            This document is intended to become a <abbr title="World Wide Web Consortium">W3C</abbr> Recommendation.
          
          
            If you wish to make comments regarding this document, please send them to 
            <a href="mailto:public-csv-wg@w3.org">public-csv-wg@w3.org</a> 
            (<a href="mailto:public-csv-wg-request@w3.org?subject=subscribe">subscribe</a>,
            <a href="http://lists.w3.org/Archives/Public/public-csv-wg/">archives</a>).
          
          
          
          
            All comments are welcome.
          
        </p>
        
        
          <p>
            Publication as a Working Draft does not imply endorsement by the <abbr title="World Wide Web Consortium">W3C</abbr>
            Membership. This is a draft document and may be updated, replaced or obsoleted by other
            documents at any time. It is inappropriate to cite this document as other than work in
            progress.
          </p>
        
        
        
        <p>
          
            This document was produced by a group operating under the 
            <a id="sotd_patent" about="" rel="w3p:patentRules" href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 <abbr title="World Wide Web Consortium">W3C</abbr> Patent
            Policy</a>.
          
          
          
            
              <abbr title="World Wide Web Consortium">W3C</abbr> maintains a <a href="http://www.w3.org/2004/01/pp-impl/68238/status" rel="disclosure">public list of any patent
              disclosures</a> 
            
            made in connection with the deliverables of the group; that page also includes
            instructions for disclosing a patent. An individual who has actual knowledge of a patent
            which the individual believes contains
            <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
            Claim(s)</a> must disclose the information in accordance with
            <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
            6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
          
          
        </p>
        
      
    
  
</section><section id="toc"><h2 id="h2_toc" role="heading" aria-level="1" class="introductory">Table of Contents</h2><ul id="respecContents" role="directory" class="toc"><li class="tocline"><a class="tocxref" href="#intro"><span class="secno">1. </span>Introduction</a></li><li class="tocline"><a class="tocxref" href="#model"><span class="secno">2. </span>Tabular Data Models</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#core-tabular-data-model"><span class="secno">2.1 </span>Core Tabular Data Model</a></li><li class="tocline"><a class="tocxref" href="#annotated-tabular-data-model"><span class="secno">2.2 </span>Annotated Tabular Data Model</a></li><li class="tocline"><a class="tocxref" href="#grouped-tabular-data-model"><span class="secno">2.3 </span>Grouped Tabular Data Model</a></li></ul></li><li class="tocline"><a class="tocxref" href="#locating-metadata"><span class="secno">3. </span>Locating Metadata</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#embedded-metadata"><span class="secno">3.1 </span>Embedded Metadata</a></li><li class="tocline"><a class="tocxref" href="#package"><span class="secno">3.2 </span>Package</a></li><li class="tocline"><a class="tocxref" href="#link-header"><span class="secno">3.3 </span>Link Header</a></li><li class="tocline"><a class="tocxref" href="#standard-path"><span class="secno">3.4 </span>Standard Path</a></li></ul></li><li class="tocline"><a class="tocxref" href="#syntax"><span class="secno">4. </span>CSV+ Syntax</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#content-type"><span class="secno">4.1 </span>Content Type</a></li><li class="tocline"><a class="tocxref" href="#encoding"><span class="secno">4.2 </span>Encoding</a></li><li class="tocline"><a class="tocxref" href="#line-endings"><span class="secno">4.3 </span>Line Endings</a></li><li class="tocline"><a class="tocxref" href="#lines"><span class="secno">4.4 </span>Lines</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#headers"><span class="secno">4.4.1 </span>Headers</a></li><li class="tocline"><a class="tocxref" href="#bidirectionality-in-csv-files"><span class="secno">4.4.2 </span>Bidirectionality in CSV+ Files</a></li></ul></li><li class="tocline"><a class="tocxref" href="#ebnf"><span class="secno">4.5 </span>Grammar</a></li></ul></li><li class="tocline"><a class="tocxref" href="#parsing"><span class="secno">5. </span>Parsing Tabular Data</a></li><li class="tocline"><a class="tocxref" href="#standards"><span class="secno">A. </span>Existing Standards</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#rfc"><span class="secno">A.1 </span>RFC 4180</a></li><li class="tocline"><a class="tocxref" href="#excel"><span class="secno">A.2 </span>Excel</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#saved-csv"><span class="secno">A.2.1 </span>Saved CSV</a></li><li class="tocline"><a class="tocxref" href="#opened-csv"><span class="secno">A.2.2 </span>Opened CSV</a></li><li class="tocline"><a class="tocxref" href="#imported-csv"><span class="secno">A.2.3 </span>Imported CSV</a></li><li class="tocline"><a class="tocxref" href="#copied-tabular-data"><span class="secno">A.2.4 </span>Copied Tabular Data</a></li></ul></li><li class="tocline"><a class="tocxref" href="#google"><span class="secno">A.3 </span>Google Spreadsheets</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#downloading-csv"><span class="secno">A.3.1 </span>Downloading CSV</a></li><li class="tocline"><a class="tocxref" href="#importing-csv"><span class="secno">A.3.2 </span>Importing CSV</a></li></ul></li><li class="tocline"><a class="tocxref" href="#csv-files-in-a-tabular-data-package"><span class="secno">A.4 </span>CSV Files in a Tabular Data Package</a></li></ul></li><li class="tocline"><a class="tocxref" href="#references"><span class="secno">B. </span>References</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><span class="secno">B.1 </span>Normative references</a></li><li class="tocline"><a class="tocxref" href="#informative-references"><span class="secno">B.2 </span>Informative references</a></li></ul></li></ul></section>
    
    <section rel="bibo:Chapter" resource="#intro" typeof="bibo:Chapter" id="intro">
      <!--OddPage--><h2 id="h2_intro" role="heading" aria-level="1"><span class="secno">1. </span>Introduction</h2>
      <p>
        <dfn id="dfn-tabular-data" title="tabular data">Tabular data</dfn> is data that is structured into rows, each of which contains information about some thing. Each row contains the same number of cells (although some of these cells may be empty), which provide values of properties of the thing described by the row. In tabular data, cells within the same column provide values for the same property of the thing described by the particular row. This is what differentiates tabular data from other line-oriented formats. 
      </p>
    	<p>
        Tabular data is routinely transferred on the web in a textual format called "CSV", but the definition of "CSV" in practice is very loose. Some people use the term to mean any delimited text file. Others stick more closely to the most standard definition of CSV that there is, [<cite><a href="#bib-RFC4180" class="bibref">RFC4180</a></cite>]. <a href="#standards" class="sectionRef">Appendix A</a> describes the various ways in which CSV is defined.
      </p>
    </section>
    <section rel="bibo:Chapter" resource="#model" typeof="bibo:Chapter" id="model">
      <!--OddPage--><h2 id="h2_model" role="heading" aria-level="1"><span class="secno">2. </span>Tabular Data Models</h2>
      <p>
        There are different levels of data models for tabular data:
      </p>
      <ul>
        <li>The <dfn id="dfn-core-tabular-data-model">core tabular data model</dfn> described in <a href="#core-tabular-data-model" class="sectionRef sec-ref">section <span class="secno">2.1</span> <span class="sec-title">Core Tabular Data Model</span></a> defines the core model for a single table of basic data.</li>
        <li>The <dfn id="dfn-annotated-tabular-data-model">annotated tabular data model</dfn> described in <a href="#annotated-tabular-data-model" class="sectionRef sec-ref">section <span class="secno">2.2</span> <span class="sec-title">Annotated Tabular Data Model</span></a> defines a model for tables that are annotated with metadata.</li>
        <li>The <dfn id="dfn-grouped-tabular-data-model">grouped tabular data model</dfn> described in <a href="#grouped-tabular-data-model" class="sectionRef sec-ref">section <span class="secno">2.3</span> <span class="sec-title">Grouped Tabular Data Model</span></a> defines a model for tables that are related to each other in some way.</li>
      </ul>
      <section id="core-tabular-data-model">
        <h3 id="h3_core-tabular-data-model" role="heading" aria-level="2"><span class="secno">2.1 </span>Core Tabular Data Model</h3>
        <p>
          The core tabular data model can be used to describe a table that lacks any annotations, whether those annotations are embedded within a CSV file or arise from a separate metadata document.
        </p>
        <p>
          Data is held in a <dfn id="dfn-table">table</dfn>. The properties of a table are:
        </p>
        <ul>
          <li><dfn id="dfn-table-columns" title="table columns">columns</dfn> — the list of <a class="internalDFN" href="#dfn-column" title="column">columns</a> in the table. A table <em title="MUST" class="rfc2119">MUST</em> have one or more columns and the order of the columns within the list is significant and <em title="MUST" class="rfc2119">MUST</em> be preserved by applications</li>
          <li><dfn id="dfn-table-rows" title="table rows">rows</dfn> — the list of rows in the table</li>
        </ul>
        <p>
          A <dfn id="dfn-column">column</dfn> represents a vertical arrangement of <a class="internalDFN" href="#dfn-cell" title="cell">cells</a> within a <a class="internalDFN" href="#dfn-table">table</a>. The properties of a column are:
        </p>
        <ul>
          <li><dfn id="dfn-column-table" title="column table">table</dfn> — the <a class="internalDFN" href="#dfn-table">table</a> that the column appears in</li>
          <li><dfn id="dfn-column-number" title="column number">number</dfn> — the position of the column amongst the <a class="internalDFN" href="#dfn-table-columns" title="table columns">columns</a> for the associated <a class="internalDFN" href="#dfn-column-table" title="column table">table</a>, starting from 1</li>
          <li><dfn id="dfn-column-cells" title="column cells">cells</dfn> — the list of <a class="internalDFN" href="#dfn-cell" title="cell">cells</a> in the column. A column <em title="MUST" class="rfc2119">MUST</em> contain one cell from each <a class="internalDFN" href="#dfn-row">row</a> in the table. The order of the cells in the list <em title="MUST" class="rfc2119">MUST</em> match the order of the rows in which they appear within the <a class="internalDFN" href="#dfn-table-rows" title="table rows">rows</a> for the associated <a class="internalDFN" href="#dfn-column-table" title="column table">table</a>.</li>
        </ul>
        <p>
          A <dfn id="dfn-row">row</dfn> represents a horizontal arrangement of <a class="internalDFN" href="#dfn-cell" title="cell">cells</a> within a <a class="internalDFN" href="#dfn-table">table</a>. The properties of a row are:
        </p>
        <ul>
          <li><dfn id="dfn-row-table" title="row table">table</dfn> — the <a class="internalDFN" href="#dfn-table">table</a> that the row appears in</li>
          <li><dfn id="dfn-row-number" title="row number">number</dfn> — the position of the row amongst the <a class="internalDFN" href="#dfn-table-rows" title="table rows">rows</a> for the <a class="internalDFN" href="#dfn-row-table" title="row table">table</a>, starting from 1</li>
          <li><dfn id="dfn-row-cells" title="row cells">cells</dfn> — the list of <a class="internalDFN" href="#dfn-cell" title="cell">cells</a> in the row. A row <em title="MUST" class="rfc2119">MUST</em> contain one cell from each <a class="internalDFN" href="#dfn-column">column</a> in the table. The order of the cells in the list <em title="MUST" class="rfc2119">MUST</em> match the order of the columns in which they appear within the <a class="internalDFN" href="#dfn-table-columns">table columns</a> for the row's table.</li>
        </ul>
        <p>
          A <dfn id="dfn-cell">cell</dfn> represents a cell at the intersection of a <a class="internalDFN" href="#dfn-row">row</a> and a <a class="internalDFN" href="#dfn-column">column</a> within a <a class="internalDFN" href="#dfn-table">table</a>. The properties of a cell are:
        </p>
        <ul>
          <li><dfn id="dfn-cell-table" title="cell table">table</dfn> — the <a class="internalDFN" href="#dfn-table">table</a> that the cell appears in</li>
          <li><dfn id="dfn-cell-column" title="cell column">column</dfn> — the <a class="internalDFN" href="#dfn-column">column</a> that the cell appears in; the cell <em title="MUST" class="rfc2119">MUST</em> be in the <a class="internalDFN" href="#dfn-column-cells" title="column cells">cells</a> for that column</li>
          <li><dfn id="dfn-cell-row" title="cell row">row</dfn> — the <a class="internalDFN" href="#dfn-row">row</a> that the cell appears in; the cell <em title="MUST" class="rfc2119">MUST</em> be in the <a class="internalDFN" href="#dfn-row-cells" title="row cells">cells</a> for that row</li>
          <li><dfn id="dfn-string-value">string value</dfn> — a string that is the original syntactic representation of the value of the cell, ie how the cell appears within a CSV file; this may be an empty string</li>
          <li><dfn id="dfn-cell-value" title="cell value">value</dfn> — the semantic value of the cell; within the core tabular data model this is either a string which is the same as the <a class="internalDFN" href="#dfn-string-value">string value</a> of the cell, or <code>null</code>, if the <a class="internalDFN" href="#dfn-string-value">string value</a> is an empty string</li>
        </ul>
        <div class="issue"><div id="h_issue_1" role="heading" aria-level="3" class="issue-title"><span>Issue 1</span></div><p class="">
          Should there be a distinction made (in the core tabular data model) between empty cells and cells whose value is an empty string? With a lack of other metadata, the only way to make the distinction would be to say there was a difference between a missing value in a CSV file (eg the second value in <code>a,,z</code>) and a quoted value (eg the second value in <code>a,"",z</code>). This seems dangerous as I don't think many clients will make a distinction between the two, so the semantics will be lost on round-tripping.
        </p></div>
      </section>
      <section id="annotated-tabular-data-model">
        <h3 id="h3_annotated-tabular-data-model" role="heading" aria-level="2"><span class="secno">2.2 </span>Annotated Tabular Data Model</h3>
        <p>
          An <dfn id="dfn-annotated-table">annotated table</dfn> is a <a class="internalDFN" href="#dfn-table">table</a> that is annotated with additional metadata. The table <em title="MAY" class="rfc2119">MAY</em> have any number of <dfn id="dfn-property" title="property">properties</dfn> in addition to those provided in the core tabular data model described in <a href="#core-tabular-data-model" class="sectionRef sec-ref">section <span class="secno">2.1</span> <span class="sec-title">Core Tabular Data Model</span></a> which provide information about the table as a whole. The <dfn id="dfn-value" title="value">values</dfn> of these properties may be lists, structured objects, or atomic values. Annotations on a table may include:
        </p>
        <ul>
          <li>titles or descriptions of the table</li>
          <li>information about the source or provenance of the data in the table</li>
          <li>links to other tables (eg to indicate tables that include related information)</li>
        </ul>
        <p>
          The <a class="internalDFN" href="#dfn-column" title="column">columns</a> within an <a class="internalDFN" href="#dfn-annotated-table">annotated table</a> are all <dfn id="dfn-annotated-column" title="annotated column">annotated columns</dfn>: columns which <em title="MAY" class="rfc2119">MAY</em> have any number of <a class="internalDFN" href="#dfn-property" title="property">properties</a> in addition to those provided in the core tabular data model described in <a href="#core-tabular-data-model" class="sectionRef sec-ref">section <span class="secno">2.1</span> <span class="sec-title">Core Tabular Data Model</span></a>. The annotations on a column might provide information about how to interpret the <a class="internalDFN" href="#dfn-cell" title="cell">cells</a> in the column or information about the column as a whole. Examples of annotations might be:
        </p>
        <ul>
          <li>a name or label for the column</li>
          <li>the expected type of values in that column</li>
          <li>an indication of whether the column contains unique values</li>
        </ul>
        <p>
          The <a class="internalDFN" href="#dfn-row" title="row">rows</a> within an <a class="internalDFN" href="#dfn-annotated-table">annotated table</a> are all <dfn id="dfn-annotated-row" title="annotated row">annotated rows</dfn>: rows which <em title="MAY" class="rfc2119">MAY</em> have any number of <a class="internalDFN" href="#dfn-property" title="property">properties</a> in addition to those provided in the core tabular data model described in <a href="#core-tabular-data-model" class="sectionRef sec-ref">section <span class="secno">2.1</span> <span class="sec-title">Core Tabular Data Model</span></a>. The annotations on a row provide additional metadata about the information held in the row, such as:
        </p>
        <ul>
          <li>the certainty of the information in that row</li>
          <li>information about the source or provenance of the data in that row</li>
        </ul>
        <p>
          The <a class="internalDFN" href="#dfn-cell" title="cell">cells</a> within an <a class="internalDFN" href="#dfn-annotated-row">annotated row</a> are all <dfn id="dfn-annotated-cell" title="annotated cell">annotated cells</dfn>: cells which <em title="MAY" class="rfc2119">MAY</em> have any number of <a class="internalDFN" href="#dfn-property" title="property">properties</a> in addition to those provided in the core tabular data model described in <a href="#core-tabular-data-model" class="sectionRef sec-ref">section <span class="secno">2.1</span> <span class="sec-title">Core Tabular Data Model</span></a>. The annotations on a cell provide metadata about the value held in the cell, particularly when this overrides the information provided for the <a class="internalDFN" href="#dfn-annotated-column">annotated column</a> and <a class="internalDFN" href="#dfn-annotated-row">annotated row</a> that the cell falls within. Annotations on a cell might be:
        </p>
        <ul>
          <li>notes to aid the interpretation of the value</li>
          <li>type annotations for the value</li>
          <li>a flag that indicates the value is a null value</li>
        </ul>
        <p>
          The <a class="internalDFN" href="#dfn-cell-value" title="cell value">value</a> of an <a class="internalDFN" href="#dfn-annotated-cell">annotated cell</a> <em title="MAY" class="rfc2119">MAY</em> be of a datatype other than a string. For example, annotations might enable a processor to understand the <a class="internalDFN" href="#dfn-string-value">string value</a> of the cell as representing a number or a date.
        </p>
        <div class="issue"><div id="h_issue_2" role="heading" aria-level="3" class="issue-title"><span>Issue 2</span></div><p class="">
          The permitted types of names and values of annotations need to be spelled out here.
        </p></div>
        <div class="issue"><div id="h_issue_3" role="heading" aria-level="3" class="issue-title"><span>Issue 3</span></div><div class="">
          <p>
            It might be useful to define annotated regions as follows:
          </p>
          <blockquote>
            An <a class="internalDFN" href="#dfn-annotated-table">annotated table</a> may also contain a number of <dfn id="dfn-annotated-region" title="annotated region">annotated regions</dfn>. Regions are themselves tabular structures comprised of selected <a class="internalDFN" href="#dfn-row" title="row">rows</a> and <a class="internalDFN" href="#dfn-column" title="column">columns</a> and the <a class="internalDFN" href="#dfn-cell" title="cell">cells</a> within those rows for those columns. Annotated regions are regions that have annotations associated with them. <a class="internalDFN" href="#dfn-annotated-column" title="annotated column">Annotated columns</a> and <a class="internalDFN" href="#dfn-annotated-row" title="annotated row">annotated rows</a> are special types of annotated regions where the region is the entirety of a single column or single row.
          </blockquote>
          <p>
            But it's not currently clear that there are use cases or examples that justify it. Input is welcome on this.
          </p>
        </div></div>
      </section>
      <section id="grouped-tabular-data-model">
        <h3 id="h3_grouped-tabular-data-model" role="heading" aria-level="2"><span class="secno">2.3 </span>Grouped Tabular Data Model</h3>
        <p>
          A <dfn id="dfn-group-of-tables">group of tables</dfn> comprises a set of <a class="internalDFN" href="#dfn-table" title="table">tables</a> (which may be <a class="internalDFN" href="#dfn-annotated-table" title="annotated table">annotated tables</a>) and a set of annotations (<a class="internalDFN" href="#dfn-property" title="property">properties</a> and <a class="internalDFN" href="#dfn-value" title="value">values</a>) that relate to the set.
        </p>
        <div class="note"><div id="h_note_1" role="heading" aria-level="3" class="note-title"><span>Note</span></div><p class="">
          Tables can be loosely related to each other simply through annotations; not all tables that are related to each other need to grouped together. Groups of tables are useful because they can be annotated with metadata that applies to all the tables in the group.
        </p></div>
      </section>
    </section>
    <section id="locating-metadata">
      <!--OddPage--><h2 id="h2_locating-metadata" role="heading" aria-level="1"><span class="secno">3. </span>Locating Metadata</h2>
      <p>
        As described in <a href="#annotated-tabular-data-model" class="sectionRef sec-ref">section <span class="secno">2.2</span> <span class="sec-title">Annotated Tabular Data Model</span></a>, tabular data may have a number of annotations associated with it. Here we describe the different methods that can be used to locate those annotations given a link to a CSV file.
      </p>
      <p>
        In most methods of locating metadata described here, metadata is provided within a separate document. The syntax of this document is defined in the <a href="http://w3c.github.io/csvw/metadata/">Metadata Vocabulary for Tabular Data</a> specification. These documents can include things like:
      </p>
      <ul>
        <li>metadata about the table, such as titles, descriptions, provenance, and links to other tables</li>
        <li>metadata about columns in the table, such as labels, data types and other constraints, or flags to indicate values in the column are unique</li>
        <li>metadata about rows in the table, such as certainty or provenance</li>
        <li>metadata about values in the table, such as notes or type annotations</li>
      </ul>
      <p>
        When creating a set of annotations from metadata, if the same property is specified in two locations then information "closer" to the document itself should override information "further" from the document. Explicitly, the order of preference is:
      </p>
      <ol>
        <li>metadata embedded within the tabular data file itself, see <a href="#embedded-metadata" class="sectionRef sec-ref">section <span class="secno">3.1</span> <span class="sec-title">Embedded Metadata</span></a></li>
        <li>metadata within a package that the tabular data file belongs to, see <a href="#package" class="sectionRef sec-ref">section <span class="secno">3.2</span> <span class="sec-title">Package</span></a></li>
        <li>metadata in a document linked to using a <code>Link</code> header when retrieving the tabular data file, see <a href="#link-header" class="sectionRef sec-ref">section <span class="secno">3.3</span> <span class="sec-title">Link Header</span></a></li>
        <li>metadata in a document located through a standard path from the tabular data file, see <a href="#standard-path" class="sectionRef sec-ref">section <span class="secno">3.4</span> <span class="sec-title">Standard Path</span></a></li>
      </ol>
      <div class="issue"><div id="h_issue_4" role="heading" aria-level="2" class="issue-title"><span>Issue 4</span></div><p class="">
        We probably need to add some rules about conflicts as well. For example, if a metadata file says that the CSV should contain certain columns but the names of the columns are different in the CSV file itself, is this an error?
      </p></div>
      <section id="embedded-metadata">
        <h3 id="h3_embedded-metadata" role="heading" aria-level="2"><span class="secno">3.1 </span>Embedded Metadata</h3>
        <p>
          The first line of a CSV+ file <em title="MUST" class="rfc2119">MUST</em> be processed as a header line unless the CSV+ file is served with a <code>header=absent</code> parameter on the media type. Each cell in the header line that includes non-whitespace characters provides a <strong>title</strong> annotation on the column in which it appears.
        </p>
        <div class="issue"><div id="h_issue_5" role="heading" aria-level="3" class="issue-title"><span>Issue 5</span></div><p class="">
          The <strong>title</strong> annotation needs to be linked to the relevant annotation in the metadata vocabulary.
        </p></div>
      </section>
      <section id="package">
        <h3 id="h3_package" role="heading" aria-level="2"><span class="secno">3.2 </span>Package</h3>
        <p>
          Rather than providing CSV files directly on the web, they can be packaged up with a metadata file that includes annotations, and any other relevant CSV files.
        </p>
        <div class="issue"><div id="h_issue_6" role="heading" aria-level="3" class="issue-title"><span>Issue 6</span></div><div class="">
          <p>
            What should that package look like? Just a zip? A multipart document? How is the metadata file within it identified? If this is allowed we should specify a new media type for the package.
          </p>
          <p>
            See <a href="http://w3ctag.github.io/packaging-on-the-web/">Packaging on the Web Editor's Draft</a> for a proposed generic approach for packaging on the web that could be used for packaging CSV files and metadata, and discovering those packages.
          </p>
        </div></div>
      </section>
      <section id="link-header">
        <h3 id="h3_link-header" role="heading" aria-level="2"><span class="secno">3.3 </span>Link Header</h3>
        <p>
          When retrieving a CSV file via HTTP, the response can include a <code>Link</code> header with <code>rel=describedby</code> that points to a metadata file that describes the CSV file. If, by inspection, the referenced file is not a valid metadata file then it <em title="MUST" class="rfc2119">MUST</em> be ignored. If there is more than one valid metadata file linked to through multiple <code>Link</code> headers, then the metadata referenced by <code>Link</code> headers that appear later in the response override that referenced by earlier <code>Link</code> headers.
        </p>
        <div class="issue"><div id="h_issue_7" role="heading" aria-level="3" class="issue-title"><span>Issue 7</span></div><p class="">
          Is <a href="http://www.w3.org/TR/powder-dr/#appD"><code>rel=describedby</code></a> the right link relation to use?
        </p></div>
      </section>
      <section id="standard-path">
        <h3 id="h3_standard-path" role="heading" aria-level="2"><span class="secno">3.4 </span>Standard Path</h3>
        <p>
          Given a CSV file, the default location for a metadata file that describes that CSV file is set to <code><var>filename</var>.csvm</code> in the same directory. If that file does not exist, then the application should look for a metadata file at <code>metadata.csvm</code> in the same directory. In both cases, if the metadata file does not explicitly point to the relevant CSV file then it <em title="MUST" class="rfc2119">MUST</em> be ignored.
        </p>
        <div class="issue"><div id="h_issue_8" role="heading" aria-level="3" class="issue-title"><span>Issue 8</span></div><p class="">
          Used a suffix on filenames to find metadata about them, though we haven't decided what format metadata documents should be in, or even if they should be conneg'd.
        </p></div>
        <div class="issue"><div id="h_issue_9" role="heading" aria-level="3" class="issue-title"><span>Issue 9</span></div><p class="">
          Should there be a default navigational thing of continuing up the path hierarchy until you find a metadata document?
        </p></div>
        <div class="issue"><div id="h_issue_10" role="heading" aria-level="3" class="issue-title"><span>Issue 10</span></div><p class="">
          We have discussed using a <code>.well-known</code> location or something within a sitemap file to provide the location of a metadata file about a given CSV file, but these are just as unlikely to be editable as a <code>Link</code> header, so probably don't address the use case that the standard path method addresses, of being a really simple way to provide metadata about a CSV file.
        </p></div>
      </section>
    </section>
    <section rel="bibo:Chapter" resource="#syntax" typeof="bibo:Chapter" id="syntax" class="informative">
      <!--OddPage--><h2 id="h2_syntax" role="heading" aria-level="1"><span class="secno">4. </span>CSV+ Syntax</h2><p><em>This section is non-normative.</em></p>
      <p>
        There is no standard for CSV, and there are many variants of CSV used on the web today. This section defines a method for outputting tabular data adhering to the <a class="internalDFN" href="#dfn-core-tabular-data-model">core tabular data model</a> described in <a href="#core-tabular-data-model" class="sectionRef sec-ref">section <span class="secno">2.1</span> <span class="sec-title">Core Tabular Data Model</span></a> into a standard, CSV-based, syntax. Compliant applications that output this format must meet each of the constraints.
      </p>
      <div class="note"><div id="h_note_2" role="heading" aria-level="2" class="note-title"><span>Note</span></div><p class="">
        We are actively working with the IETF to develop a standard for CSV, which is outside the scope of the Working Group. The details here aim to help shape that standard based on our requirements.
      </p></div>
      <p>
        This section does not seek to describe how applications that <em>input</em> textual tabular data should interpret it, except that any data that is in the format defined here should be understood as defined here.
      </p>
      <div class="note"><div id="h_note_3" role="heading" aria-level="2" class="note-title"><span>Note</span></div><div class="">
        <p>
          This syntax is not compliant with <code>text/csv</code> as defined in [<cite><a href="#bib-RFC4180" class="bibref">RFC4180</a></cite>]: it permits characters other than ASCII, and it permits line endings other than <code>CRLF</code>. Supporting the full set of Unicode characters by using UTF-8 and supporting <code>LF</code> line endings are important characteristics for data formats that are used internationally and on non-Windows platforms. However, all files that adhere to [<cite><a href="#bib-RFC4180" class="bibref">RFC4180</a></cite>]'s definition of CSV are compliant CSV+ files.
        </p>
      </div></div>
      <section rel="bibo:Chapter" resource="#content-type" typeof="bibo:Chapter" id="content-type">
        <h3 id="h3_content-type" role="heading" aria-level="2"><span class="secno">4.1 </span>Content Type</h3>
        <p>
          The appropriate content type for a CSV+ file is <code>text/csv</code>. For example, when a CSV+ file is transmitted via HTTP, the HTTP response <em title="MUST" class="rfc2119">MUST</em> include a <code>Content-Type</code> header with the value <code>text/csv</code>:
        </p>
        <pre>Content-Type: text/csv
        </pre>
        <div class="issue"><div id="h_issue_11" role="heading" aria-level="3" class="issue-title"><span>Issue 11</span></div><p class="">
          See below for issues relating to whether we should instead define a different content type.
        </p></div>
      </section>
      <section rel="bibo:Chapter" resource="#encoding" typeof="bibo:Chapter" id="encoding">
        <h3 id="h3_encoding" role="heading" aria-level="2"><span class="secno">4.2 </span>Encoding</h3>
        <p>
          CSV+ files <em title="SHOULD" class="rfc2119">SHOULD</em> be encoded using UTF-8. If a CSV+ file is not encoded using UTF-8, the encoding <em title="MUST" class="rfc2119">MUST</em> be specified through the <code>charset</code> parameter in the <code>Content-Type</code> header:
        </p>
        <pre>Content-Type: text/csv;charset=ISO-8859-1
        </pre>
        <div class="issue"><div id="h_issue_12" role="heading" aria-level="3" class="issue-title"><span>Issue 12</span></div><div class="">
          <p>
            RFC4180 defines the default charset as US-ASCII because that was (at the time RFC4180 was written) the default charset for all <code>text/*</code> media types. This has been superseded with RFC6657.
            <a href="http://tools.ietf.org/html/rfc6657#section-3">Section 3 of RFC6657</a> states "new subtypes of the "text" media type <em title="SHOULD NOT" class="rfc2119">SHOULD NOT</em> define a default "charset" value.  If there is a strong reason to do so despite this advice, they <em title="SHOULD" class="rfc2119">SHOULD</em> use the "UTF-8" [RFC3629] charset as the default."
          </p>
          <p>
            Do we have a strong reason to specify a default charset? Should we be defining <code>application/csv</code> instead, to avoid doing unrecommended things with a <code>text/*</code> media type.
          </p>
        </div></div>
      </section>
      <section rel="bibo:Chapter" resource="#line-endings" typeof="bibo:Chapter" id="line-endings">
        <h3 id="h3_line-endings" role="heading" aria-level="2"><span class="secno">4.3 </span>Line Endings</h3>
        <p>
          The ends of rows in a CSV+ file <em title="MUST" class="rfc2119">MUST</em> be either <code>CRLF</code> (<code>U+000D U+000A</code>) or <code>LF</code> (<code>U+000A</code>). Line endings within escaped <a class="internalDFN" href="#dfn-cell" title="cell">cells</a> are not normalised.
        </p>
        <div class="issue"><div id="h_issue_13" role="heading" aria-level="3" class="issue-title"><span>Issue 13</span></div><div class="">
          <p>
            <a href="http://tools.ietf.org/html/rfc2046#section-4.1.1">Section 4.1.1 of RFC2046</a> specifies that "The canonical form of any MIME "text" subtype <em title="MUST" class="rfc2119">MUST</em> always represent a line break as a CRLF sequence.  Similarly, any occurrence of CRLF in MIME "text" <em title="MUST" class="rfc2119">MUST</em> represent a line break.  Use of CR and LF outside of line break sequences is also forbidden."
          </p>
          <p>
            Should we be defining <code>application/csv</code> instead, to prevent having to adhere to this rule, or should we stick to the <code>CRLF</code> rule?
          </p>
        </div></div>
      </section>
      <section rel="bibo:Chapter" resource="#lines" typeof="bibo:Chapter" id="lines">
        <h3 id="h3_lines" role="heading" aria-level="2"><span class="secno">4.4 </span>Lines</h3>
        <p>
          Each line of a CSV+ file <em title="MUST" class="rfc2119">MUST</em> contain the same number of comma-separated values.
        </p>
        <p>
          Values that contain commas, line endings or double quotes <em title="MUST" class="rfc2119">MUST</em> be escaped by having the entire value wrapped in double quotes. There <em title="MUST NOT" class="rfc2119">MUST NOT</em> be whitespace before or after the double quotes. Within these escaped cells, any double quotes <em title="MUST" class="rfc2119">MUST</em> be escaped with two double quotes (<code>""</code>).
        </p>
        <section rel="bibo:Chapter" resource="#headers" typeof="bibo:Chapter" id="headers">
          <h4 id="h4_headers" role="heading" aria-level="3"><span class="secno">4.4.1 </span>Headers</h4>
          <p>
            The first line of a CSV+ file <em title="SHOULD" class="rfc2119">SHOULD</em> contain a comma-separated list of names of <a class="internalDFN" href="#dfn-column" title="column">columns</a>. This is known as the <dfn id="dfn-header-line">header line</dfn> and provides names for the columns. There are no constraints on these names.
          </p>
          <p>
            If a CSV+ file does not include a header line, this <em title="MUST" class="rfc2119">MUST</em> be specified using the <code>header</code> parameter of the media type:
          </p>
          <pre>Content-Type: text/csv;header=absent
          </pre>
        </section>
        <section id="bidirectionality-in-csv-files">
          <h4 id="h4_bidirectionality-in-csv-files" role="heading" aria-level="3"><span class="secno">4.4.2 </span>Bidirectionality in CSV+ Files</h4>
          <p>
            Bidirectional content does not alter the definition of rows or the assignment of cells to columns. Whether or not a CSV+ file contains right-to-left characters, the first column's content is the first cell of each row, which is the text prior to the first occurrence of a comma within that row.
          </p>
          <div class="example">
            <p>
              For example, <a href="http://referendum2012.elections.eg/results/referendum-results">Egyptian Referendum results</a> are available as a CSV file at <a href="https://egelections-2011.appspot.com/Referendum2012/results/csv/EG.csv">https://egelections-2011.appspot.com/Referendum2012/results/csv/EG.csv</a>. Over the wire and in non-Unicode-aware text editors, the CSV looks like:
            </p>
            <pre>              <bdo dir="ltr">
‌ا‌ل‌م‌ح‌ا‌ف‌ظ‌ة‌,‌ن‌س‌ب‌ة‌ ‌م‌و‌ا‌ف‌ق‌,‌ن‌س‌ب‌ة‌ ‌غ‌ي‌ر‌ ‌م‌و‌ا‌ف‌ق‌,‌ع‌د‌د‌ ‌ا‌ل‌ن‌ا‌خ‌ب‌ي‌ن‌,‌ا‌ل‌أ‌ص‌و‌ا‌ت‌ ‌ا‌ل‌ص‌ح‌ي‌ح‌ة‌,‌ا‌ل‌أ‌ص‌و‌ا‌ت‌ ‌ا‌ل‌ب‌ا‌ط‌ل‌ة‌,‌ن‌س‌ب‌ة‌ ‌ا‌ل‌م‌ش‌ا‌ر‌ك‌ة‌,‌م‌و‌ا‌ف‌ق‌,‌غ‌ي‌ر‌ ‌م‌و‌ا‌ف‌ق‌
‌ا‌ل‌ق‌ل‌ي‌و‌ب‌ي‌ة‌,60.0,40.0,"2,639,808","853,125","15,224",32.9,"512,055","341,070"
‌ا‌ل‌ج‌ي‌ز‌ة‌,66.7,33.3,"4,383,701","1,493,092","24,105",34.6,"995,417","497,675"
‌ا‌ل‌ق‌ا‌ه‌ر‌ة‌,43.2,56.8,"6,580,478","2,254,698","36,342",34.8,"974,371","1,280,327"
‌ق‌ن‌ا‌,84.5,15.5,"1,629,713","364,509","6,743",22.8,"307,839","56,670"
...
              </bdo>
            </pre>
            <p>
              Within this CSV file, the first column appears as the content of each line before the first comma and is named <code>المحافظة</code> (appearing at the start of each row as <code><bdo dir="ltr">‌ا‌ل‌م‌ح‌ا‌ف‌ظ‌ة‌</bdo></code> in the example, which is displaying the relevant characters from left to right in the order they appear "on the wire").
            </p>
            <p>
              The CSV translates to a table model that looks like:
            </p>
            <table style="width: 100%; text-align: right">
              <colgroup><col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              </colgroup><thead>
                <tr style="text-align: center">
                  <th>Column / Row</th>
                  <th>column 1</th>
                  <th>column 2</th>
                  <th>column 3</th>
                  <th>column 4</th>
                  <th>column 5</th>
                  <th>column 6</th>
                  <th>column 7</th>
                  <th>column 8</th>
                  <th>column 9</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>row 1 (header)</th><th>المحافظة</th><th>نسبة موافق</th><th>نسبة غير موافق</th><th>عدد الناخبين</th><th>الأصوات الصحيحة</th><th>الأصوات الباطلة</th><th>نسبة المشاركة</th><th>موافق</th><th>غير موافق</th>
                </tr>
                <tr>
                  <th>row 2</th><td>القليوبية</td><td>60.0</td><td>40.0</td><td>2,639,808</td><td>853,125</td><td>15,224</td><td>32.9</td><td>512,055</td><td>341,070</td>
                </tr>
                <tr>
                  <th>row 3</th><td>الجيزة</td><td>66.7</td><td>33.3</td><td>4,383,701</td><td>1,493,092</td><td>24,105</td><td>34.6</td><td>995,417</td><td>497,675</td>
                </tr>
                <tr>
                  <th>row 4</th><td>القاهرة</td><td>43.2</td><td>56.8</td><td>6,580,478</td><td>2,254,698</td><td>36,342</td><td>34.8</td><td>974,371</td><td>1,280,327</td>
                </tr>
                <tr>
                  <th>row 5</th><td>قنا</td><td>84.5</td><td>15.5</td><td>1,629,713</td><td>364,509</td><td>6,743</td><td>22.8</td><td>307,839</td><td>56,670</td>
                </tr>
              </tbody>
            </table>
            <p>
              The fragment identifier <code>#col=3</code> identifies the third of the columns, named <code>نسبة غير موافق</code> (appearing as <code><bdo dir="ltr">‌ن‌س‌ب‌ة‌ ‌غ‌ي‌ر‌ ‌م‌و‌ا‌ف‌ق‌</bdo></code> in the example).
            </p>
            <p>
              [<cite><a href="#bib-tabular-metadata" class="bibref">tabular-metadata</a></cite>] defines how this table model should be displayed by compliant applications, and how metadata can affect the display. The default is for the display to be determined by the content of the table. For example, if this CSV were turned into an HTML table for display into a web page, it should be displayed with the first column on the right and the last on the left, as follows:
            </p>
            <table style="width: 100%; text-align: right">
              <thead>
                <tr>
                  <th>غير موافق</th>
                  <th>موافق</th>
                  <th>نسبة المشاركة</th>
                  <th>الأصوات الباطلة</th>
                  <th>الأصوات الصحيحة</th>
                  <th>عدد الناخبين</th>
                  <th>نسبة غير موافق</th>
                  <th>نسبة موافق</th>
                  <th>المحافظة</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>341,070</td>
                  <td>512,055</td>
                  <td>32.9</td>
                  <td>15,224</td>
                  <td>853,125</td>
                  <td>2,639,808</td>
                  <td>40.0</td>
                  <td>60.0</td>
                  <td>القليوبية</td>
                </tr>
                <tr>
                  <td>497,675</td>
                  <td>995,417</td>
                  <td>34.6</td>
                  <td>24,105</td>
                  <td>1,493,092</td>
                  <td>4,383,701</td>
                  <td>33.3</td>
                  <td>66.7</td>
                  <td>الجيزة</td>
                </tr>
                <tr>
                  <td>1,280,327</td>
                  <td>974,371</td>
                  <td>34.8</td>
                  <td>36,342</td>
                  <td>2,254,698</td>
                  <td>6,580,478</td>
                  <td>56.8</td>
                  <td>43.2</td>
                  <td>القاهرة</td>
                </tr>
                <tr>
                  <td>56,670</td>
                  <td>307,839</td>
                  <td>22.8</td>
                  <td>6,743</td>
                  <td>364,509</td>
                  <td>1,629,713</td>
                  <td>15.5</td>
                  <td>84.5</td>
                  <td>قنا</td>
                </tr>
              </tbody>
            </table>
            <p>
              The fragment identifier <code>#col=3</code> still identifies the third of the columns, named <code>نسبة غير موافق</code>, which appears in the HTML display as the third column from the right and is what those who read right-to-left would think of as the third column.
            </p>
            <p>
              Note that this display matches that shown <a href="http://referendum2012.elections.eg/results/referendum-results">on the original website</a>.
            </p>
          </div>
          <div class="issue"><div id="h_issue_14" role="heading" aria-level="4" class="issue-title"><span>Issue 14</span></div><div class="">
            <p>
              An alternative approach is for the CSV to be parsed into a table model in which the columns are numbered in the reverse, for tables which are either marked as or detected to be right-to-left tables. For example, we could introduce a <code>bidi=rtl</code> or similar media type parameter, and use this to determine whether the first column in table generated from the CSV is the text before the first comma in each line or the text after the last comma in the line.
            </p>
            <p>
             In the example above, if the CSV were served with <code>bidi=rtl</code>, or the table was detected as being a right-to-left table, then the column numbering in the model would be reversed:
            </p>
            <table style="width: 100%; text-align: right">
              <colgroup><col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              <col style="width: 10%">
              </colgroup><thead>
                <tr style="text-align: center">
                  <th>Column / Row</th>
                  <th>column 9</th>
                  <th>column 8</th>
                  <th>column 7</th>
                  <th>column 6</th>
                  <th>column 5</th>
                  <th>column 4</th>
                  <th>column 3</th>
                  <th>column 2</th>
                  <th>column 1</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>row 1 (header)</th><th>المحافظة</th><th>نسبة موافق</th><th>نسبة غير موافق</th><th>عدد الناخبين</th><th>الأصوات الصحيحة</th><th>الأصوات الباطلة</th><th>نسبة المشاركة</th><th>موافق</th><th>غير موافق</th>
                </tr>
                <tr>
                  <th>row 2</th><td>القليوبية</td><td>60.0</td><td>40.0</td><td>2,639,808</td><td>853,125</td><td>15,224</td><td>32.9</td><td>512,055</td><td>341,070</td>
                </tr>
                <tr>
                  <th>row 3</th><td>الجيزة</td><td>66.7</td><td>33.3</td><td>4,383,701</td><td>1,493,092</td><td>24,105</td><td>34.6</td><td>995,417</td><td>497,675</td>
                </tr>
                <tr>
                  <th>row 4</th><td>القاهرة</td><td>43.2</td><td>56.8</td><td>6,580,478</td><td>2,254,698</td><td>36,342</td><td>34.8</td><td>974,371</td><td>1,280,327</td>
                </tr>
                <tr>
                  <th>row 5</th><td>قنا</td><td>84.5</td><td>15.5</td><td>1,629,713</td><td>364,509</td><td>6,743</td><td>22.8</td><td>307,839</td><td>56,670</td>
                </tr>
              </tbody>
            </table>
            <p>
              This would require a change to [<cite><a href="#bib-RFC7111" class="bibref">RFC7111</a></cite>] but that might be required by updates to the definition of <code>text/csv</code> in any case. With the change, the fragment identifier <code>#col=3</code> would then refer to the third column from the right, named <code>نسبة المشاركة</code>.
            </p>
            <p>
              If the model were defined in this way, there would be no need to determine the order of the columns when displayed using a metadata property. Columns would always be displayed with the first column (numbered 1 in the model) on the left. The final display in HTML, for example, would be exactly as above. The only difference would be that <code>#col=3</code> would refer to the third column from the left.
            </p>
            <p>
              We note that using media type parameters is problematic because publishers might not have the ability to set them on their servers, and because they can easily get lost as a file is republished or emailed between people.
            </p>
            <p>
              We invite comment on the best way to approach bidirectionality in CSV files.
            </p>
          </div></div>
        </section>
      </section>

      <section rel="bibo:Chapter" resource="#ebnf" typeof="bibo:Chapter" id="ebnf">
        <h3 id="h3_ebnf" role="heading" aria-level="2"><span class="secno">4.5 </span>Grammar</h3>
        <p>This grammar is a generalization of that defined in [<cite><a href="#bib-RFC4180" class="bibref">RFC4180</a></cite>] and is included for reference only.</p>
        <p>The <abbr title="Extended Backus–Naur Form">EBNF</abbr> used here is defined in XML 1.0 [<cite><a href="#bib-EBNF-NOTATION" class="bibref">EBNF-NOTATION</a></cite>].</p>
        <div><table class="grammar">
  <tbody id="grammar-productions">
    <tr id="grammar-production-csv">
      <td>[1]</td>
      <td><code>csv</code></td>
      <td>::=</td>
      <td>
        <a href="#grammar-production-header">header</a>
        <a href="#grammar-production-record">record</a><code>+</code>
      </td>
    </tr>
    <tr id="grammar-production-header">
      <td>[2]</td>
      <td><code>header</code></td>
      <td>::=</td>
      <td>
        <a href="#grammar-production-record">record</a>
      </td>
    </tr>
    <tr id="grammar-production-record">
      <td>[3]</td>
      <td><code>record</code></td>
      <td>::=</td>
      <td>
        <a href="#grammar-production-fields">fields</a>
        <code class="grammar-char-escape">#x0D</code><code>?</code> 
        <code class="grammar-char-escape">#x0A</code>
      </td>
    </tr>
    <tr id="grammar-production-fields">
      <td>[4]</td>
      <td><code>fields</code></td>
      <td>::=</td>
      <td>
        <a href="#grammar-production-field">field</a>
        ("<code class="grammar-literal">,</code>" <a href="#grammar-production-fields">fields</a>)<code>*</code>
      </td>
    </tr>
    <tr id="grammar-production-field">
      <td>[5]</td>
      <td><code>field</code></td>
      <td>::=</td>
      <td>
        <a href="#grammar-production-WS">WS</a><code>*</code> 
        <a href="#grammar-production-rawfield">rawfield</a>
        <a href="#grammar-production-WS">WS</a><code>*</code>
      </td>
    </tr>
    <tr id="grammar-production-rawfield">
      <td>[6]</td>
      <td><code>rawfield</code></td>
      <td>::=</td>
      <td>
        '<code class="grammar-literal">"</code>' <a href="#grammar-production-QCHAR">QCHAR</a><code>*</code>  '<code class="grammar-literal">"</code>'
        <code>|</code><a href="#grammar-production-SCHAR">SCHAR</a><code>*</code>
      </td>
    </tr>
    <tr id="grammar-production-QCHAR">
      <td>[7]</td>
      <td><code>QCHAR</code></td>
      <td>::=</td>
      <td>
        <code>[</code><code class="grammar-literal">^"</code><code>]</code> 
        <code>|</code>'<code class="grammar-literal">""</code>'
      </td>
    </tr>
    <tr id="grammar-production-SCHAR">
      <td>[8]</td>
      <td><code>SCHAR</code></td>
      <td>::=</td>
      <td>
        <code>[</code><code class="grammar-literal">^",</code><code class="grammar-char-escape">#x0A</code><code class="grammar-char-escape">#x0D</code><code>]</code>
      </td>
    </tr>
    <tr id="grammar-production-WS">
      <td>[9]</td>
      <td><code>WS</code></td>
      <td>::=</td>
      <td>
        <code>[</code><code class="grammar-char-escape">#x20</code><code class="grammar-char-escape">#x09</code><code>]</code>
      </td>
    </tr>
  </tbody>
</table>
</div>
        <div class="note"><div id="h_note_4" role="heading" aria-level="3" class="note-title"><span>Note</span></div><p class="">
          We should probably place further restrictions on QCHAR and SCHAR to avoid control characters. If header weren’t optional, it would be better defined as in RFC4180, but if the syntax allows it to be optional, this would make it not an LL(1) grammar, which isn’t too much of an issue.
        </p></div>
      </section>
    </section>
    <section rel="bibo:Chapter" resource="#parsing" typeof="bibo:Chapter" id="parsing" class="informative">
      <!--OddPage--><h2 id="h2_parsing" role="heading" aria-level="1"><span class="secno">5. </span>Parsing Tabular Data</h2><p><em>This section is non-normative.</em></p>
      <p>
        As described in <a href="#syntax" class="sectionRef sec-ref">section <span class="secno">4.</span> <span class="sec-title">CSV+ Syntax</span></a>, there may be many formats which an application might interpret into the tabular data model described in <a href="#model" class="sectionRef sec-ref">section <span class="secno">2.</span> <span class="sec-title">Tabular Data Models</span></a>, including using different separators or fixed format tables, multiple tables within a single file, or ones that have metadata lines before a table header.
      </p>
      <div class="note"><div id="h_note_5" role="heading" aria-level="2" class="note-title"><span>Note</span></div><p class="">
        Standardising the parsing of CSV is outside the chartered scope of the Working Group. This non-normative section is intended to help the creators of parsers handle the wide variety of CSV-based formats that they may encounter due to the current lack of standardisation of the format.
      </p></div>
      <p>
        This section describes an algorithm for parsing formats other than the plain CSV+ format specified in <a href="#syntax" class="sectionRef sec-ref">section <span class="secno">4.</span> <span class="sec-title">CSV+ Syntax</span></a>. It is impossible to do this in a fully automated manner, so this algorithm depends on the following flags being set externally (eg through user input):
      </p>
      <dl>
        <dt><dfn id="dfn-encoding">encoding</dfn></dt>
        <dd>The character encoding for the file, one of the encodings listed in [<cite><a href="#bib-encoding" class="bibref">encoding</a></cite>]. The default is <code>utf-8</code>.</dd>
        <dt><dfn id="dfn-row-terminator">row terminator</dfn></dt>
        <dd>The character that is used at the end of a row. The default is <code>CRLF</code>.</dd>
        <dt><dfn id="dfn-enclosure-character">enclosure character</dfn></dt>
        <dd>The character that is used around escaped cells. The default is <code>"</code>.</dd>
        <dt><dfn id="dfn-escape-character">escape character</dfn></dt>
        <dd>The character that is used to escape the <a class="internalDFN" href="#dfn-enclosure-character">enclosure character</a> within escaped cells. The default is <code>"</code>.</dd>
        <dt><dfn id="dfn-skip-rows">skip rows</dfn></dt>
        <dd>The number of rows to skip at the beginning of the file, before a header row or tabular data. The default is <code>0</code>.</dd>
        <dt><dfn id="dfn-comment-prefix">comment prefix</dfn></dt>
        <dd>A character that, when it appears at the beginning of a skipped row, indicates a comment that should be associated as a comment annotation to the table. The default is <code>#</code>.</dd>
        <dt><dfn id="dfn-header-row-count">header row count</dfn></dt>
        <dd>The number of header rows (following the skipped rows) in the file. The default is <code>1</code>.</dd>
        <dt><dfn id="dfn-delimiter">delimiter</dfn></dt>
        <dd>The separator between cells. The default is <code>,</code>.</dd>
        <dt><dfn id="dfn-skip-columns">skip columns</dfn></dt>
        <dd>The number of columns to skip at the beginning of each row, before any header columns. The default is <code>0</code>.</dd>
        <dt><dfn id="dfn-header-column-count">header column count</dfn></dt>
        <dd>The number of header columns (following the skipped columns) in each row. The default is <code>0</code>.</dd>
        <dt><dfn id="dfn-skip-blank-rows">skip blank rows</dfn></dt>
        <dd>Indicates whether to ignore wholly empty rows (ie rows in which all the cells are empty). The default is <code>false</code>.</dd>
        <dt><dfn id="dfn-trim">trim</dfn></dt>
        <dd>Indicates whether to trim whitespace around cells.</dd>
      </dl>
      <div class="issue"><div id="h_issue_15" role="heading" aria-level="2" class="issue-title"><span>Issue 15</span></div><div class="">
        <p>
          When parsing, should we:
        </p>
        <ul>
          <li>always trim whitespace around cells?</li>
          <li>always create empty cells for missing cells?</li>
        </ul>
      </div></div>
      <p>
        The algorithm for parsing a document containing tabular data is as follows:
      </p>
      <ol>
        <li>Read the file using the specified <a class="internalDFN" href="#dfn-encoding">encoding</a>.</li>
        <li>Find the rows. Each row ends with a <a class="internalDFN" href="#dfn-row-terminator">row terminator</a>, but values that are enclosed within the <a class="internalDFN" href="#dfn-enclosure-character">enclosure character</a> may contain the <a class="internalDFN" href="#dfn-row-terminator">row terminator</a> without it indicating the end of the row. The <a class="internalDFN" href="#dfn-enclosure-character">enclosure character</a> may be escaped using the <a class="internalDFN" href="#dfn-escape-character">escape character</a> where it appears within cells.</li>
        <li>Skip the number of rows indicated by the <a class="internalDFN" href="#dfn-skip-rows">skip rows</a> parameter.</li>
        <li>Within the skipped rows, find rows that start with the <a class="internalDFN" href="#dfn-comment-prefix">comment prefix</a>. These form comment annotations on the table.</li>
        <li>Gather the number of header rows indicated by the <a class="internalDFN" href="#dfn-header-row-count">header row count</a> parameter; the remaining rows are data rows.</li>
        <li>
          <p>
            Split the header and data rows into cells using the <a class="internalDFN" href="#dfn-delimiter">delimiter</a>. Values that are enclosed within the <a class="internalDFN" href="#dfn-enclosure-character">enclosure character</a> may contain the <a class="internalDFN" href="#dfn-delimiter">delimiter</a>. The <a class="internalDFN" href="#dfn-enclosure-character">enclosure character</a> may be escaped using the <a class="internalDFN" href="#dfn-escape-character">escape character</a> where it appears within cells.
          </p>
          <p>
            If <a class="internalDFN" href="#dfn-trim">trim</a> is <code>true</code> or <code>start</code> then whitespace from the start of values that are not enclosed must be removed from the value. If <a class="internalDFN" href="#dfn-trim">trim</a> is <code>true</code> or <code>end</code> then whitespace from the end of values that are not enclosed must be removed from the value.
          </p>
        </li>
        <li>In each row, ignore the number of columns indicated by the <a class="internalDFN" href="#dfn-skip-columns">skip columns</a> parameter. Always start from the first character in the row when counting columns (see <a href="#bidirectionality-in-csv-files" class="sectionRef sec-ref">section <span class="secno">4.4.2</span> <span class="sec-title">Bidirectionality in CSV+ Files</span></a>).</li>
        <li>Gather the number of header columns indicated by the <a class="internalDFN" href="#dfn-header-column-count">header column count</a> parameter. Always start from the first character in the row when counting columns (see <a href="#bidirectionality-in-csv-files" class="sectionRef sec-ref">section <span class="secno">4.4.2</span> <span class="sec-title">Bidirectionality in CSV+ Files</span></a>).</li>
        <li>Each cell within a header row that is not in a skipped or header column is a label annotation on that column.</li>
        <li>Each cell within a header column is an annotation on the row it appears in; if there is a header row then that provides the type of the annotation for the row, otherwise it is a label annotation.</li>
        <li>If <a class="internalDFN" href="#dfn-skip-blank-rows">skip blank rows</a> is <code>true</code> then ignore any rows in which all the cell values are empty strings.</li>
      </ol>
      <!-- alternative, more procedural appraoch would be something like this:
      <p>
        To <dfn>read a row</dfn>:
      </p>
      <ol>
        <li>set <var>cells</var> to an empty list</li>
        <li>set <var>skipped rows</var> to <code>0</code></li>
        <li>set <var>header rows</var> to an empty list</li>
        <li><a>read a cell</a> and add that value to the <var>cells</var> list</li>
        <li>if the next character is whitespace, then if <a>trim</a> is <code>true</code> or <code>end</code> then ignore the next whitespace characters, otherwise raise an error.</li>
        <li>otherwise, if the next character is the <a>delimiter</a> then go back to step 2.</li>
        <li>otherwise, if the next character is the <a>row terminator</a> then return the list of <var>cells</var> as the content of the row.</li>
      </ol>
    -->
    </section>
    <section rel="bibo:Chapter" resource="#standards" typeof="bibo:Chapter" class="appendix" id="standards">
      <!--OddPage--><h2 id="h2_standards" role="heading" aria-level="1"><span class="secno">A. </span>Existing Standards</h2>
      <p>
        This appendix outlines various ways in which CSV is defined.
      </p>
      <section rel="bibo:Chapter" resource="#rfc" typeof="bibo:Chapter" id="rfc">
        <h3 id="h3_rfc" role="heading" aria-level="2"><span class="secno">A.1 </span>RFC 4180</h3>
        <p>
          [<cite><a href="#bib-RFC4180" class="bibref">RFC4180</a></cite>] defines CSV with the following ABNF grammar:
        </p>
        <pre>file = [header CRLF] record *(CRLF record) [CRLF]
header = name *(COMMA name)
record = field *(COMMA field)
name = field
field = (escaped / non-escaped)
escaped = DQUOTE *(TEXTDATA / COMMA / CR / LF / 2DQUOTE) DQUOTE
non-escaped = *TEXTDATA
COMMA = %x2C
CR = %x0D
DQUOTE =  %x22
LF = %x0A
CRLF = CR LF
TEXTDATA =  %x20-21 / %x23-2B / %x2D-7E
        </pre>
        <p>
          Of particular note here are:
        </p>
        <ul>
          <li>The production for <code>TEXTDATA</code> indicates that only non-control ASCII characters are permitted within a CSV file. This restriction is routinely ignored in practice, and is impractical on the international web.</li>
          <li>Lines should be ended with <code>CRLF</code>. This makes it harder to produce CSV files on Unix-based systems where the usual line ending is <code>LF</code>.</li>
          <li>The header line is optional; a <code>header</code> parameter on the media type indicates whether the header is present or not.</li>
          <li>Fields may be escaped by wrapping them in double quotes; any double quotes within the field must be escaped with two double quotes (<code>""</code>).</li>
        </ul>
      </section>
      <section rel="bibo:Chapter" resource="#excel" typeof="bibo:Chapter" id="excel">
        <h3 id="h3_excel" role="heading" aria-level="2"><span class="secno">A.2 </span>Excel</h3>
        <p>
          Excel is a common tool for both creating and reading CSV documents, and therefore the CSV that it produces is a de facto standard.
        </p>
        <div class="note"><div id="h_note_6" role="heading" aria-level="3" class="note-title"><span>Note</span></div><p class="">
          The following describes the behaviour of Microsoft Excel for Mac 2011 with an English locale. Further testing is needed to see the behaviour of Excel in other situations.
        </p></div>
        <section id="saved-csv">
          <h4 id="h4_saved-csv" role="heading" aria-level="3"><span class="secno">A.2.1 </span>Saved CSV</h4>
          <p>
            Excel generates CSV files encoded using Windows-1252 with <code>LF</code> line endings. Characters that cannot be represented within Windows-1252 are replaced by underscores. Only those cells that need escaping (eg because they contain commas or double quotes) are escaped, and double quotes are escaped with two double quotes.
          </p>
          <p>
            Dates and numbers are formatted as displayed, which means that formatting can lead to information being lost or becoming inconsistent.
          </p>
        </section>
        <section id="opened-csv">
          <h4 id="h4_opened-csv" role="heading" aria-level="3"><span class="secno">A.2.2 </span>Opened CSV</h4>
          <p>
            When opening CSV files, Excel interprets CSV files saved in UTF-8 as being encoded as Windows-1252 (whether or not a <a href="http://en.wikipedia.org/wiki/Byte_order_mark"><abbr title="Byte Order Mark">BOM</abbr></a> is present). It correctly deals with double quoted cells, except that it converts line breaks within cells into spaces. It understands <code>CRLF</code> as a line break. It detects dates (formatted as <code>YYYY-MM-DD</code>) and formats them in the default date formatting for files.
          </p>
        </section>
        <section id="imported-csv">
          <h4 id="h4_imported-csv" role="heading" aria-level="3"><span class="secno">A.2.3 </span>Imported CSV</h4>
          <p>
            Excel provides more control when importing CSV files into Excel. However, it does not properly understand UTF-8 (with or without <abbr title="Byte Order Mark">BOM</abbr>). It does however properly understand UTF-16 and can read non-ASCII characters from a UTF-16-encoded file.
          </p>
          <p>
            A particular quirk in the importing of CSV is that if a cell contains a line break, the final double quote that escapes the cell will be included within it.
          </p>
        </section>
        <section id="copied-tabular-data">
          <h4 id="h4_copied-tabular-data" role="heading" aria-level="3"><span class="secno">A.2.4 </span>Copied Tabular Data</h4>
          <p>
            When tabular data is copied from Excel, it is copied in a tab-delimited format, with <code>LF</code> line breaks.
          </p>
        </section>
      </section>
      <section rel="bibo:Chapter" resource="#google" typeof="bibo:Chapter" id="google">
        <h3 id="h3_google" role="heading" aria-level="2"><span class="secno">A.3 </span>Google Spreadsheets</h3>
        <section id="downloading-csv">
          <h4 id="h4_downloading-csv" role="heading" aria-level="3"><span class="secno">A.3.1 </span>Downloading CSV</h4>
          <p>
            Downloaded CSV files are encoded in UTF-8, without a <a href="http://en.wikipedia.org/wiki/Byte_order_mark"><abbr title="Byte Order Mark">BOM</abbr></a>, and with <code>LF</code> line endings. Dates and numbers are formatted as they appear within the spreadsheet.
          </p>
        </section>
        <section id="importing-csv">
          <h4 id="h4_importing-csv" role="heading" aria-level="3"><span class="secno">A.3.2 </span>Importing CSV</h4>
          <p>
            CSV files can be imported as UTF-8 (with or without <abbr title="Byte Order Mark">BOM</abbr>). <code>CRLF</code> line endings are correctly recognised. Dates are reformatted to the default date format on load.
          </p>
        </section>
      </section>
      <section id="csv-files-in-a-tabular-data-package">
        <h3 id="h3_csv-files-in-a-tabular-data-package" role="heading" aria-level="2"><span class="secno">A.4 </span>CSV Files in a Tabular Data Package</h3>
        <p>
          <a href="http://dataprotocols.org/tabular-data-package/#csv-files">Tabular Data Packages</a> place the following restrictions on CSV files:
        </p>
        <blockquote>
          <p>As a starting point, CSV files included in a Tabular Data Package package must conform to the RFC for CSV (4180 - Common Format and MIME Type for Comma-Separated Values (CSV) Files). In addition:</p>

          <ul>
            <li>File names <em title="MUST" class="rfc2119">MUST</em> end with <code>.csv</code></li>
            <li>Files <em title="MUST" class="rfc2119">MUST</em> be encoded as UTF-8</li>
            <li>
              <p>Files <em title="MUST" class="rfc2119">MUST</em> have a single header row. This row <em title="MUST" class="rfc2119">MUST</em> be the first row in the
          file.</p>

              <ul>
                <li>Terminology: each column in the CSV file is termed a <em>field</em> and
          its <code>name</code> is the string in that column in the header row.</li>
                <li>The <code>name</code> <em title="MUST" class="rfc2119">MUST</em> be unique amongst fields and <em title="MUST" class="rfc2119">MUST</em> contain at
          least one character</li>
                <li>There are no further restrictions on the form of the <code>name</code> but
          it is <em title="RECOMMENDED" class="rfc2119">RECOMMENDED</em> that it contain only alphanumeric characters
          together with “ .-_”</li>
              </ul>
            </li>
            <li>Rows in the file <em title="MUST NOT" class="rfc2119">MUST NOT</em> contain more fields than are in the header row (though they may
          contain less)</li>
            <li>Each file <em title="MUST" class="rfc2119">MUST</em> have an entry in the <code>resources</code> array in the <code>datapackage.json</code> file</li>
            <li>The resource metadata <em title="MUST" class="rfc2119">MUST</em> include a <code>schema</code> attribute whose value <em title="MUST" class="rfc2119">MUST</em> conform to the JSON
          Table Schema</li>
            <li>All fields in the CSV files <em title="MUST" class="rfc2119">MUST</em> be described in the <code>schema</code></li>
          </ul>

          <p>CSV files generated by different applications often vary in their syntax, e.g. use of quoting characters, delimiters, etc. To encourage conformance, CSV files in a CSV files in a Tabular Data Package <em title="SHOULD" class="rfc2119">SHOULD</em></p>

          <ul>
            <li>Use “,” as field delimiters</li>
            <li>Use “rn” or “n” as line terminators</li>
          </ul>

          <p>If a CSV file does not follow these rules then its specific CSV dialect <em title="MUST" class="rfc2119">MUST</em> be documented. The resource 
          hash for the resource in the <code>datapackage.json</code> descriptor <em title="MUST" class="rfc2119">MUST</em>:</p>

          <ul>
            <li>Include a <code>dialect</code> key that conforms to that described in the <a href="http://dataprotocols.org/csv-dialect/">CSV Dialect Description Format</a></li>
          </ul>

          <p>Applications processing the CSV file <em title="SHOULD" class="rfc2119">SHOULD</em> read use the <code>dialect</code> of the CSV file to guide parsing.</p>
        </blockquote>
      </section>
      <div class="issue"><div id="h_issue_16" role="heading" aria-level="2" class="issue-title"><span>Issue 16</span></div><div class="">
        <p>
          More details of behaviour of other tools should go here. This should include the most popular CSV parsing/generating libraries in common programming languages. Test files which include non-ASCII characters, double quotes and line breaks within cells are:
        </p>
        <ul>
          <li><a href="test-utf8.csv">test-utf8.csv</a></li>
          <li><a href="test-utf8-bom.csv">test-utf8-bom.csv</a></li>
          <li><a href="test-utf16.csv">test-utf16.csv</a></li>
          <li><a href="test-utf16-bom.csv">test-utf16-bom.csv</a></li>
          <li><a href="test.xlsx">test.xslx</a></li>
          <li><a href="test.xls">test.xsl</a></li>
        </ul>
      </div></div>
    </section>
  


<section rel="bibo:Chapter" resource="#references" typeof="bibo:Chapter" id="references" class="appendix"><!--OddPage--><h2 id="h2_references" role="heading" aria-level="1"><span class="secno">B. </span>References</h2><section rel="bibo:Chapter" resource="#normative-references" typeof="bibo:Chapter" id="normative-references"><h3 id="h3_normative-references" role="heading" aria-level="2"><span class="secno">B.1 </span>Normative references</h3><dl about="" class="bibliography"><dt id="bib-RFC4180">[RFC4180]</dt><dd rel="dcterms:requires">Y. Shafranovich. <a href="http://www.ietf.org/rfc/rfc4180.txt"><cite>Common Format and MIME Type for Comma-Separated Values (CSV) Files</cite></a>. October 2005. Informational. URL: <a href="http://www.ietf.org/rfc/rfc4180.txt">http://www.ietf.org/rfc/rfc4180.txt</a>
</dd><dt id="bib-encoding">[encoding]</dt><dd rel="dcterms:requires">Anne van Kesteren; Joshua Bell; Addison Phillips. <a href="http://www.w3.org/TR/encoding/"><cite>Encoding</cite></a>. 3 June 2014. W3C Last Call Working Draft. URL: <a href="http://www.w3.org/TR/encoding/">http://www.w3.org/TR/encoding/</a>
</dd><dt id="bib-tabular-metadata">[tabular-metadata]</dt><dd rel="dcterms:requires">Rufus Pollock; Jeni Tennison. <a href="http://www.w3.org/TR/2014/WD-tabular-metadata-20140710/"><cite>Metadata Vocabulary for Tabular Data</cite></a>. W3C Working Draft. URL: <a href="http://www.w3.org/TR/2014/WD-tabular-metadata-20140710/">http://www.w3.org/TR/2014/WD-tabular-metadata-20140710/</a>
</dd></dl></section><section rel="bibo:Chapter" resource="#informative-references" typeof="bibo:Chapter" id="informative-references"><h3 id="h3_informative-references" role="heading" aria-level="2"><span class="secno">B.2 </span>Informative references</h3><dl about="" class="bibliography"><dt id="bib-EBNF-NOTATION">[EBNF-NOTATION]</dt><dd rel="dcterms:references">Tim Bray; Jean Paoli; C. Michael Sperberg-McQueen; Eve Maler; François Yergau. <a href="http://www.w3.org/TR/REC-xml/#sec-notation"><cite>EBNF Notation</cite></a>. W3C Recommendation. URL: <a href="http://www.w3.org/TR/REC-xml/#sec-notation">http://www.w3.org/TR/REC-xml/#sec-notation</a>
</dd><dt id="bib-RFC7111">[RFC7111]</dt><dd rel="dcterms:references">Michael Hausenblas; Erik Wilde; Jenni Tennison. <a href="http://www.ietf.org/rfc/rfc7111.txt"><cite>URI Fragment Identifiers for the text/csv Media Type</cite></a>. Internet RFC. URL: <a href="http://www.ietf.org/rfc/rfc7111.txt">http://www.ietf.org/rfc/rfc7111.txt</a>
</dd></dl></section></section></body></html>